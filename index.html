<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relationship Assessment</title>
    
    <!-- PayPal SDK - YOUR CLIENT ID -->
    <script src="https://www.paypal.com/sdk/js?client-id=AVKL7Ad1FM9eIVcPEfpL3vxWMrCWqQeTgi-zFg7GOxZWnGL-PvLYtQodVaWzKXViz8FLuxp3giK6aGiV&currency=USD"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .step-container {
            padding: 40px 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input[type="number"],
        input[type="email"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .question-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .question-card h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .scale-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .scale-option {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scale-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .scale-option input[type="radio"] {
            margin-right: 12px;
            cursor: pointer;
        }

        .scale-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .button-group {
            margin-top: 30px;
        }

        .analysis-preview {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .analysis-preview h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .analysis-preview ul {
            list-style: none;
        }

        .analysis-preview li {
            padding: 8px 0;
            color: #555;
        }

        .price-info {
            text-align: center;
            margin: 25px 0;
            font-size: 24px;
            color: #667eea;
        }

        #paypal-button-container {
            margin: 25px 0;
        }

        .loading-container {
            text-align: center;
            padding: 60px 30px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            color: #856404;
        }

        .info-box strong {
            display: block;
            margin-bottom: 8px;
        }

/* NEW MODERN RESULTS STYLES */
.results-wrapper {
    background: linear-gradient(135deg, #fff5f7 0%, #ffe8ec 50%, #ffd6dd 100%);
    padding: 40px 30px;
    min-height: 100vh;
}

.score-header {
    background: linear-gradient(135deg, #ff6b9d 0%, #c86dd7 100%);
    border-radius: 24px;
    padding: 50px 35px;
    margin-bottom: 40px;
    color: white;
    text-align: center;
    box-shadow: 0 15px 40px rgba(255, 107, 157, 0.3);
    position: relative;
    overflow: hidden;
}

.score-header::before {
    content: 'ðŸ’•';
    position: absolute;
    font-size: 120px;
    opacity: 0.1;
    top: -20px;
    right: -20px;
}

.score-header h2 {
    font-size: 34px;
    margin-bottom: 40px;
    font-weight: 700;
    letter-spacing: -0.5px;
}

.score-display {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    max-width: 600px;
    margin: 0 auto;
}

.score-card {
    background: rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(15px);
    padding: 35px 25px;
    border-radius: 20px;
    text-align: center;
    border: 2px solid rgba(255, 255, 255, 0.5);
    transition: all 0.4s ease;
}

.score-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

.score-value {
    font-size: 58px;
    font-weight: 900;
    margin-bottom: 12px;
    text-shadow: 0 3px 15px rgba(0, 0, 0, 0.2);
    background: linear-gradient(135deg, #ffffff 0%, #ffe8ec 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.score-label {
    font-size: 16px;
    opacity: 0.95;
    font-weight: 600;
    letter-spacing: 0.8px;
    text-transform: uppercase;
}

.analysis-card {
    background: white;
    border-radius: 24px;
    padding: 40px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(255, 107, 157, 0.15);
    border: 2px solid rgba(255, 182, 193, 0.3);
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
}

.analysis-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, #ff6b9d 0%, #c86dd7 50%, #ff6b9d 100%);
    background-size: 200% 100%;
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

.analysis-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 50px rgba(255, 107, 157, 0.25);
    border-color: rgba(255, 107, 157, 0.5);
}

.analysis-card-header {
    display: flex;
    align-items: center;
    margin-bottom: 28px;
    padding-bottom: 20px;
    border-bottom: 2px solid rgba(255, 182, 193, 0.2);
}

.icon-circle {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 20px;
    flex-shrink: 0;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    transition: transform 0.3s ease;
}

.analysis-card:hover .icon-circle {
    transform: rotate(5deg) scale(1.1);
}

.icon-circle svg {
    width: 32px;
    height: 32px;
}

.icon-blue {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    color: #c2185b;
}

.icon-green {
    background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
    color: #7b1fa2;
}

.icon-purple {
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    color: #e91e63;
}

.icon-pink {
    background: linear-gradient(135deg, #ff6b9d 0%, #c86dd7 100%);
    color: white;
}

.analysis-card h3 {
    font-size: 26px;
    color: #d81b60;
    margin: 0;
    font-weight: 700;
    letter-spacing: -0.3px;
}

.analysis-content {
    color: #555;
    line-height: 2;
    font-size: 17px;
    letter-spacing: 0.2px;
}

.analysis-content p {
    margin-bottom: 20px;
}

.analysis-content p:last-child {
    margin-bottom: 0;
}

.analysis-content strong {
    color: #c2185b;
    font-weight: 700;
}

.email-notification {
    background: linear-gradient(135deg, #ff6b9d 0%, #c86dd7 100%);
    color: white;
    padding: 35px;
    border-radius: 20px;
    text-align: center;
    margin-top: 40px;
    font-size: 19px;
    box-shadow: 0 15px 40px rgba(255, 107, 157, 0.35);
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.email-notification svg {
    width: 42px;
    height: 42px;
    margin-bottom: 15px;
    filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.2));
}

.email-notification strong {
    display: block;
    font-size: 26px;
    margin-bottom: 10px;
    font-weight: 800;
}

@media (max-width: 600px) {
    .results-wrapper {
        padding: 25px 15px;
    }
    
    .score-display {
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .score-header {
        padding: 40px 25px;
    }

    .score-header h2 {
        font-size: 28px;
        margin-bottom: 30px;
    }

    .score-value {
        font-size: 46px;
    }

    .analysis-card {
        padding: 28px 22px;
    }

    .analysis-card h3 {
        font-size: 22px;
    }

    .icon-circle {
        width: 56px;
        height: 56px;
    }

    .icon-circle svg {
        width: 28px;
        height: 28px;
    }

    .analysis-content {
        font-size: 16px;
        line-height: 1.8;
    }

    .email-notification {
        padding: 28px 20px;
        font-size: 17px;
    }

    .email-notification strong {
        font-size: 22px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Confidential Relationship Assessment</h1>
            <p>Get professional insights into your relationship</p>
        </div>

        <!-- Step 1: Basic Information -->
        <div id="basic-info-container" class="step-container">
            <h2>Basic Information</h2>
            <form id="basic-info-form">
                <div class="form-group">
                    <label for="userAge">Your Age</label>
                    <input type="number" id="userAge" min="18" max="100" required>
                </div>

                <div class="form-group">
                    <label for="partnerAge">Partner's Age</label>
                    <input type="number" id="partnerAge" min="18" max="100" required>
                </div>

                <div class="form-group">
                    <label for="relationshipDuration">How long have you been together?</label>
                    <select id="relationshipDuration" required>
                        <option value="">Select duration</option>
                        <option value="Less than a month">Less than a month</option>
                        <option value="1-3 months">1-3 months</option>
                        <option value="3-6 months">3-6 months</option>
                        <option value="6-12 months">6-12 months</option>
                        <option value="1-2 years">1-2 years</option>
                        <option value="More than 2 years">More than 2 years</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userEmail">Your Email (for results)</label>
                    <input type="email" id="userEmail" required>
                </div>

                <div class="form-group">
                    <label for="concerns">What are your main concerns?</label>
                    <textarea id="concerns" required placeholder="Please share your concerns in detail..."></textarea>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">Continue</button>
                </div>
            </form>
        </div>

        <!-- Step 2: Behavioral Assessment -->
        <div id="followup-container" class="step-container" style="display: none;">
            <h2>Behavioral Assessment</h2>
            
            <div class="info-box">
                <strong>Important:</strong> These questions assess common relationship patterns. Changes in behavior can have many explanations beyond infidelity, including stress, depression, or life transitions.
            </div>

            <form id="followup-form">
                <!-- Question 1: Emotional Distance -->
                <div class="question-card">
                    <h3>1. Has your partner become emotionally distant or detached recently?</h3>
                    <div class="scale-options">
                        <label class="scale-option">
                            <input type="radio" name="q1" value="1" required>
                            <span>Not at all - Same emotional connection as always</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q1" value="2">
                            <span>Slightly - Minor changes, could be stress</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q1" value="3">
                            <span>Moderately - Noticeable withdrawal from conversations</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q1" value="4">
                            <span>Significantly - Feels like talking to a stranger</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q1" value="5">
                            <span>Extremely - Complete emotional disconnect</span>
                        </label>
                    </div>
                </div>

                <!-- Question 2: Technology & Privacy -->
                <div class="question-card">
                    <h3>2. Have there been sudden changes in phone/device privacy habits?</h3>
                    <div class="scale-options">
                        <label class="scale-option">
                            <input type="radio" name="q2" value="1" required>
                            <span>No changes - Same openness as before</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q2" value="2">
                            <span>Minor - Slightly more protective but reasonable</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q2" value="3">
                            <span>Moderate - New passwords, face-down phone placement</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q2" value="4">
                            <span>Significant - Takes calls privately, deletes messages</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q2" value="5">
                            <span>Extreme - Completely guarded, defensive when questioned</span>
                        </label>
                    </div>
                </div>

                <!-- Question 3: Schedule Changes -->
                <div class="question-card">
                    <h3>3. Are there unexplained absences or changes in availability?</h3>
                    <div class="scale-options">
                        <label class="scale-option">
                            <input type="radio" name="q3" value="1" required>
                            <span>No - Schedule is transparent and consistent</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q3" value="2">
                            <span>Rarely - Occasional late work with clear explanations</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q3" value="3">
                            <span>Sometimes - Vague about whereabouts, new "commitments"</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q3" value="4">
                            <span>Frequently - Often unavailable with weak excuses</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q3" value="5">
                            <span>Constantly - Large unexplained time gaps regularly</span>
                        </label>
                    </div>
                </div>

                <!-- Question 4: Appearance & Habits -->
                <div class="question-card">
                    <h3>4. Have you noticed sudden changes in appearance, grooming, or spending?</h3>
                    <div class="scale-options">
                        <label class="scale-option">
                            <input type="radio" name="q4" value="1" required>
                            <span>No changes - Same routine and style</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q4" value="2">
                            <span>Minor - Small updates, self-improvement phase</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q4" value="3">
                            <span>Moderate - New cologne/perfume, different clothing style</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q4" value="4">
                            <span>Significant - Major makeover, unexplained expenses</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q4" value="5">
                            <span>Dramatic - Complete transformation, secretive purchases</span>
                        </label>
                    </div>
                </div>

                <!-- Question 5: Intimacy Changes -->
                <div class="question-card">
                    <h3>5. Have there been significant changes in physical intimacy?</h3>
                    <div class="scale-options">
                        <label class="scale-option">
                            <input type="radio" name="q5" value="1" required>
                            <span>No change - Same level of affection and intimacy</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q5" value="2">
                            <span>Slight decrease - Could be stress or fatigue</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q5" value="3">
                            <span>Moderate change - Noticeable avoidance or new preferences</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q5" value="4">
                            <span>Significant - Rare intimacy or sudden increase (guilt-driven)</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q5" value="5">
                            <span>Extreme - Complete avoidance or drastically different behavior</span>
                        </label>
                    </div>
                </div>

                <!-- Question 6: Defensiveness -->
                <div class="question-card">
                    <h3>6. How does your partner react to simple questions about their day?</h3>
                    <div class="scale-options">
                        <label class="scale-option">
                            <input type="radio" name="q6" value="1" required>
                            <span>Open - Shares freely, welcomes conversation</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q6" value="2">
                            <span>Mostly open - Occasionally brief but not defensive</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q6" value="3">
                            <span>Guarded - Vague answers, changes subject</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q6" value="4">
                            <span>Defensive - Gets irritated, accuses you of being nosy</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q6" value="5">
                            <span>Hostile - Angry reactions, picks fights to deflect</span>
                        </label>
                    </div>
                </div>

                <!-- Question 7: Interest in Your Life -->
                <div class="question-card">
                    <h3>7. How interested is your partner in your life and well-being?</h3>
                    <div class="scale-options">
                        <label class="scale-option">
                            <input type="radio" name="q7" value="1" required>
                            <span>Very interested - Asks about your day, cares about details</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q7" value="2">
                            <span>Interested - Checks in regularly</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q7" value="3">
                            <span>Somewhat distant - Polite but superficial</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q7" value="4">
                            <span>Disinterested - Rarely asks, seems preoccupied</span>
                        </label>
                        <label class="scale-option">
                            <input type="radio" name="q7" value="5">
                            <span>Completely disconnected - Shows no interest at all</span>
                        </label>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">Continue</button>
                    <button type="button" class="btn btn-secondary" onclick="showBasicInfoStep()">Back</button>
                </div>
            </form>
        </div>

        <!-- Step 3: Payment -->
        <div id="payment-container" class="step-container" style="display: none;">
            <h2>Get Your Analysis</h2>
            
            <div class="analysis-preview">
                <h3>What you'll receive:</h3>
                <ul>
                    <li>âœ“ Comprehensive behavioral pattern analysis</li>
                    <li>âœ“ Context-aware assessment (not just accusations)</li>
                    <li>âœ“ Alternative explanations for behaviors</li>
                    <li>âœ“ Constructive communication strategies</li>
                    <li>âœ“ Professional recommendations</li>
                    <li>âœ“ Results sent to your email</li>
                </ul>
            </div>
            
            <div class="info-box">
                <strong>Weekly tracking recommended:</strong> Patterns over time are more significant than isolated incidents. Consider reassessing weekly to track changes.
            </div>
            
            <div class="price-info">
                <p>Investment: <strong>$1.00</strong></p>
            </div>
            
            <!-- PayPal button renders here -->
            <div id="paypal-button-container"></div>
            
            <button type="button" class="btn btn-secondary" onclick="showFollowUpStep()">Back</button>
        </div>

        <!-- Step 4: Loading -->
        <div id="loading-container" class="loading-container" style="display: none;">
            <div class="spinner"></div>
            <h3>Analyzing your relationship data...</h3>
            <p>This may take 30-60 seconds</p>
        </div>

        <!-- Step 5: Results (COMPLETELY REDESIGNED) -->
        <div id="results-container" class="results-wrapper" style="display: none;">
            <!-- Scores Header -->
            <div class="score-header">
                <h2>Your Relationship Analysis</h2>
                <div class="score-display">
                    <div class="score-card">
                        <div class="score-value" id="concern-score">--</div>
                        <div class="score-label">Concern Level</div>
                    </div>
                    <div class="score-card">
                        <div class="score-value" id="health-score">--</div>
                        <div class="score-label">Health Score</div>
                    </div>
                </div>
            </div>

            <!-- Behavioral Pattern Analysis -->
            <div class="analysis-card">
                <div class="analysis-card-header">
                    <div class="icon-circle icon-blue">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <h3>Behavioral Pattern Analysis</h3>
                </div>
                <div class="analysis-content" id="detailed-analysis"></div>
            </div>

            <!-- Context & Alternative Explanations -->
            <div class="analysis-card">
                <div class="analysis-card-header">
                    <div class="icon-circle icon-green">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <h3>Context & Alternative Explanations</h3>
                </div>
                <div class="analysis-content" id="context-analysis"></div>
            </div>

            <!-- Recommended Actions -->
            <div class="analysis-card">
                <div class="analysis-card-header">
                    <div class="icon-circle icon-purple">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <h3>Recommended Actions</h3>
                </div>
                <div class="analysis-content" id="expert-advice"></div>
            </div>

            <!-- Communication Strategies -->
            <div class="analysis-card">
                <div class="analysis-card-header">
                    <div class="icon-circle icon-pink">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                    </div>
                    <h3>Communication Strategies</h3>
                </div>
                <div class="analysis-content" id="communication-tips"></div>
            </div>

            <!-- Email Notification -->
            <div class="email-notification">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                <div><strong>Results Sent!</strong></div>
                <div>A copy of this analysis has been sent to your email.</div>
            </div>
        </div>
    </div>

    <script>
        let formData = {};
        let followUpAnswers = {};

        // Basic Info Form
        document.getElementById('basic-info-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            formData = {
                userAge: document.getElementById('userAge').value,
                partnerAge: document.getElementById('partnerAge').value,
                relationshipDuration: document.getElementById('relationshipDuration').value,
                userEmail: document.getElementById('userEmail').value,
                concerns: document.getElementById('concerns').value
            };
            
            showFollowUpStep();
        });

        // Follow-up Form
        document.getElementById('followup-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            followUpAnswers = {
                emotionalDistance: parseInt(document.querySelector('input[name="q1"]:checked').value),
                technologyPrivacy: parseInt(document.querySelector('input[name="q2"]:checked').value),
                scheduleChanges: parseInt(document.querySelector('input[name="q3"]:checked').value),
                appearanceChanges: parseInt(document.querySelector('input[name="q4"]:checked').value),
                intimacyChanges: parseInt(document.querySelector('input[name="q5"]:checked').value),
                defensiveness: parseInt(document.querySelector('input[name="q6"]:checked').value),
                interestInYou: parseInt(document.querySelector('input[name="q7"]:checked').value)
            };
            
            showPaymentStep();
        });

        // Visual feedback for radio selections
        document.querySelectorAll('.scale-option').forEach(option => {
            option.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                const name = radio.name;
                
                // Remove selected class from all options in this group
                document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                    r.closest('.scale-option').classList.remove('selected');
                });
                
                // Add selected class to clicked option
                this.classList.add('selected');
            });
        });

        function showBasicInfoStep() {
            document.getElementById('basic-info-container').style.display = 'block';
            document.getElementById('followup-container').style.display = 'none';
            document.getElementById('payment-container').style.display = 'none';
        }

        function showFollowUpStep() {
            document.getElementById('basic-info-container').style.display = 'none';
            document.getElementById('followup-container').style.display = 'block';
            document.getElementById('payment-container').style.display = 'none';
        }

        function showPaymentStep() {
            document.getElementById('followup-container').style.display = 'none';
            document.getElementById('payment-container').style.display = 'block';
            
            // Clear any existing PayPal buttons
            const container = document.getElementById('paypal-button-container');
            container.innerHTML = '';
            
            // Render PayPal button
            paypal.Buttons({
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: '1.00',
                                currency_code: 'USD'
                            },
                            description: 'Relationship Assessment Analysis'
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(async function(orderData) {
                        console.log('Payment completed:', orderData);
                        
                        // Show loading
                        document.getElementById('payment-container').style.display = 'none';
                        document.getElementById('loading-container').style.display = 'block';
                        
                        // Call serverless function
                        try {
                            const response = await fetch('/api/analyze.js', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    orderId: orderData.id,
                                    formData: formData,
                                    followUpAnswers: followUpAnswers
                                })
                            });
                            
                            const result = await response.json();
                            
                            if (result.success) {
                                displayResults(result.analysis);
                            } else {
                                throw new Error(result.error || 'Analysis failed');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Failed to generate analysis. Please contact support with order ID: ' + orderData.id);
                            document.getElementById('loading-container').style.display = 'none';
                            document.getElementById('payment-container').style.display = 'block';
                        }
                    });
                },
                onError: function(err) {
                    console.error('PayPal error:', err);
                    alert('Payment failed. Please try again.');
                }
            }).render('#paypal-button-container');
        }

        function displayResults(analysis) {
            document.getElementById('loading-container').style.display = 'none';
            document.getElementById('results-container').style.display = 'block';
            
            // Display scores
            document.getElementById('concern-score').textContent = analysis.concernLevel;
            document.getElementById('health-score').textContent = analysis.healthScore;
            
            // Display analysis sections with proper paragraph formatting
            document.getElementById('detailed-analysis').innerHTML = formatText(analysis.detailedAnalysis);
            document.getElementById('context-analysis').innerHTML = formatText(analysis.contextAnalysis);
            document.getElementById('expert-advice').innerHTML = formatText(analysis.expertAdvice);
            document.getElementById('communication-tips').innerHTML = formatText(analysis.communicationTips);
            
            // Scroll to results
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
        }

        function formatText(text) {
            // Split by double newlines for paragraphs, or single newlines if no double ones exist
            const paragraphs = text.split('\n\n').length > 1 
                ? text.split('\n\n') 
                : text.split('\n');
            
            return paragraphs
                .filter(p => p.trim())
                .map(p => `<p>${p.trim()}</p>`)
                .join('');
        }
    </script>
</body>
</html>


